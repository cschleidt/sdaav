<!DOCTYPE html>
<html>
<head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>The bar in New York</title>

    <link rel="stylesheet" type="text/css" href="styles.css" />

    <style type="text/css">
        .categories-choropleth {
            fill: #ccc;
        }

        button {
            border: 1px solid #f44c0e;
            color: #fff;
            background: lightgray;
            padding: 10px 20px;
            margin: 15px 10px;
            border-radius: 3px;
        }
        button:hover {
            background: lightblue;
        }

        #tooltip-container {
            position: absolute;
            background-color: #fff;
            color: #000;
            padding: 10px;
            border: 1px solid;
            display: none;
            text-shadow:none;
        }

        .tooltip_key {
            font-weight: bold;
        }

        .tooltip_value {
            margin-left: 20px;
            float: right;
        }
    </style>

</head>

<body>

    <section id="page">
        <!-- Defining the #page section with the section tag -->

        <header>
            <!-- Defining the header section of the page with the appropriate tag -->

            <hgroup>
                <h1>SDAAV</h1>
                <h3>the bar in New York</h3>
            </hgroup>

            <nav class="clear">
                <!-- The nav link semantically marks your main site navigation -->
                <ul>
                    <li><a href="#article1">Exploration</a></li>
                    <li><a href="#article2">Analysis</a></li>
                    <li><a href="#article3">Conclusion</a></li>
                </ul>
            </nav>

        </header>

        <section id="articles">
            <!-- A new section with the articles -->
            <!-- Article 1 start -->
            <div class="line"></div>  <!-- Dividing line -->

            <article id="article1">
                <!-- The new article tag. The id is supplied so it can be scrolled into view. -->
                <h2>Bar in New York</h2>

                <div class="line"></div>

                <div class="articleBody clear">

                    <div id="viz"></div>
<!--
                    AirComplaints
                    GraffitiComplaints
                    IncidentZip
                    PartyBarComplaints
                    RodentComplaints
                    TotalComplaints
                    UrineComplaints
-->
 			        <div id="selectors" style="padding-left:18%">
				        <button onclick="ChangeComplaintType(1)">Air</button>
				        <button onclick="ChangeComplaintType(2)">Grafitti</button>
				        <button onclick="ChangeComplaintType(3)">Party</button>
				        <button onclick="ChangeComplaintType(4)">Rodent</button>
				        <button onclick="ChangeComplaintType(5)">Urine</button>
			        </div>
                    <div id="tooltip-container"></div>
                    <p>....</p>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer luctus quam quis nibh fringilla sit amet consectetur lectus malesuada. Sed nec libero erat. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc mi nisi, rhoncus ut vestibulum ac, sollicitudin quis lorem. Duis felis dui, vulputate nec adipiscing nec, interdum vel tortor. Sed gravida, erat nec rutrum tincidunt, metus mauris imperdiet nunc, et elementum tortor nunc at eros. Donec malesuada congue molestie. Suspendisse potenti. Vestibulum cursus congue sem et feugiat. Morbi quis elit odio. </p>
                </div>
            </article>

            <!-- Article 1 end -->
            <!-- Article 2 start -->
            <div class="line"></div>

            <article id="article2">
                <h2>Sweet AJAX Tabs</h2>
                <!--

                                    <div class="line"></div>

                                    <div class="articleBody clear">
                                        <figure>
                                            <a href="http://tutorialzine.com/2010/01/sweet-tabs-jquery-ajax-css/"><img src="http://tutorialzine.com/img/featured/633.jpg" width="620" height="340" /></a>
                                        </figure>

                                        <p>Here we are making sweet AJAX-powered tabs with CSS3 and the newly released version 1.4 of jQuery.</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer luctus quam quis nibh fringilla sit amet consectetur lectus malesuada. Sed nec libero erat. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc mi nisi, rhoncus ut vestibulum ac, sollicitudin quis lorem. Duis felis dui, vulputate nec adipiscing nec, interdum vel tortor. Sed gravida, erat nec rutrum tincidunt, metus mauris imperdiet nunc, et elementum tortor nunc at eros. Donec malesuada congue molestie. Suspendisse potenti. Vestibulum cursus congue sem et feugiat. Morbi quis elit odio. </p>
                                    </div>
                -->
            </article>

            <!-- Article 2 end -->
            <!-- Article 3 start -->
            <div class="line"></div>

            <article id="article3">
                <h2>Halftone Navigation Menu</h2>
                <!--

                                    <div class="line"></div>

                                    <div class="articleBody clear">
                                        <figure>
                                            <a href="http://tutorialzine.com/2010/01/halftone-navigation-menu-jquery-css/"><img src="http://tutorialzine.com/img/featured/610.jpg" width="620" height="340" /></a>
                                        </figure>

                                        <p>Today we are making a CSS3 & jQuery halftone-style navigation menu, which will allow you to display animated halftone-style shapes in accordance with the navigation links, and will provide a simple editor for creating additional shapes as well.</p>
                                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer luctus quam quis nibh fringilla sit amet consectetur lectus malesuada. Sed nec libero erat. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc mi nisi, rhoncus ut vestibulum ac, sollicitudin quis lorem. Duis felis dui, vulputate nec adipiscing nec, interdum vel tortor. Sed gravida, erat nec rutrum tincidunt, metus mauris imperdiet nunc, et elementum tortor nunc at eros. Donec malesuada congue molestie. Suspendisse potenti. Vestibulum cursus congue sem et feugiat. Morbi quis elit odio. </p>
                                    </div>
                -->
            </article>
        </section>
        <footer>
            <!-- Marking the footer section -->
            <div class="line"></div>

            <p>Copyright 2017 - The bar team</p>

            <a href="#" class="up">Go UP</a>

        </footer>

    </section> <!-- Closing the #page section -->
    <!-- JavaScript Includes -->

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script src="jquery.scrollTo-1.4.2/jquery.scrollTo-min.js"></script>
    <script src="script.js"></script>
    <script src="scripts/colors.js"></script>
    <script type="text/javascript" src="//d3js.org/d3.v3.min.js"></script>
</body>
<script>

var COLOR_COUNTS = 5;

var valueById = d3.map();

var mycolors = new MyColors(COLOR_COUNTS);
var colorrange = mycolors.colors;

var quantize = d3.scale.quantize()
    .domain([0, 1.0])
    .range(d3.range(COLOR_COUNTS).map(function(i) { return i }));

var complaintdata;
var geojsonnyc;

d3.csv("zipgrouped.csv", function(error, names) {
    // save data structure
    complaintdata = names;

    // for default - show partycomplaints
    names.forEach(function(d) {
        var id = d.IncidentZip;
        valueById.set(id, d.PartyBarComplaints);
    });

    quantize.domain([d3.min(names, function(d){ return d.PartyBarComplaints }),
        d3.max(names, function(d){ return d.PartyBarComplaints })]);

    makeMap(colorrange, quantize);
});

function ChangeComplaintType(complatinttype)
{
    /*
        AirComplaints
        GraffitiComplaints
        IncidentZip
        PartyBarComplaints
        RodentComplaints
        TotalComplaints
        UrineComplaints
    */

    switch(complatinttype) {
        case 1:
            complaintdata.forEach(function(d) {
                var id = d.IncidentZip;
                valueById.set(id, d.AirComplaints);
            });

            quantize.domain([d3.min(complaintdata, function(d){ return d.AirComplaints }),
                d3.max(complaintdata, function(d){ return d.AirComplaints })]);
            break;
        case 2:
            complaintdata.forEach(function(d) {
                var id = d.IncidentZip;
                valueById.set(id, d.GraffitiComplaints);
            });

            quantize.domain([d3.min(complaintdata, function(d){ return d.GraffitiComplaints }),
                d3.max(complaintdata, function(d){ return d.GraffitiComplaints })]);
            break;
        case 3:
            complaintdata.forEach(function(d) {
                var id = d.IncidentZip;
                valueById.set(id, d.PartyBarComplaints);
            });

            quantize.domain([d3.min(complaintdata, function(d){ return d.PartyBarComplaints }),
                d3.max(complaintdata, function(d){ return d.PartyBarComplaints })]);
            break;
        case 4:
            complaintdata.forEach(function(d) {
                var id = d.IncidentZip;
                valueById.set(id, d.RodentComplaints);
            });

            quantize.domain([d3.min(complaintdata, function(d){ return d.RodentComplaints }),
                d3.max(complaintdata, function(d){ return d.RodentComplaints })]);
            break;
        case 5:
            complaintdata.forEach(function(d) {
                var id = d.IncidentZip;
                valueById.set(id, d.UrineComplaints);
                console.log(d.UrineComplaints);
            });

            quantize.domain([d3.min(complaintdata, function(d){ return d.UrineComplaints }),
                d3.max(complaintdata, function(d){ return d.UrineComplaints })]);
            break;
        default:
            break;
    }

    updatemap(colorrange, quantize);
}

function makeMap(mapcolors, scalemethod)
    {
        var w = 900, h = 500
        var projection = d3.geo.mercator()
            .center([-73.926522306614344, 40.704388796109033])
            .translate([w/2, h/2])
            .scale([55000]);

        var svg = d3.select("#viz")
            .append("svg")
            .attr("width", w)
            .attr("height", h);

        var path = d3.geo.path()
                .projection(projection);

        d3.json("nyc.json", function(json) {
            //console.log(json);  //Log output to console

            geojsonnyc = json;

            svg.append("g")
                .attr("class", "categories-choropleth")
                .selectAll("path")
                .data(json.features)
                .enter()
                .append("path")
                .attr("d", path)
                .style("stroke-width", "1")
                .style("stroke", "black")
                //.style('fill-opacity', 0.3)


                .on("mouseover", function(d) {
                    //console.log(d);

                    var html = "";

                    html += "<div class='tooltip_kv'>";
                    html += "<span class='tooltip_key'>";
                    html += "Party complaints";
                    html += "</span>";
                    html += "<span class='tooltip_value'>";
                    html += valueById.get(d.properties.postalCode);
                    html += "";
                    html += "</span>";
                    html += "</div>";

                    $("#tooltip-container").html(html);
                    $(this).attr("fill-opacity", "0.8");
                    $("#tooltip-container").show();

                    var coordinates = d3.mouse(this);

                    var map_width = $('.categories-choropleth')[0].getBoundingClientRect().width;

                    if (d3.event.layerX < map_width / 2) {
                        d3.select("#tooltip-container")
                        .style("top", (d3.event.layerY + 15) + "px")
                        .style("left", (d3.event.layerX + 15) + "px");
                    } else {
                        var tooltip_width = $("#tooltip-container").width();
                        d3.select("#tooltip-container")
                        .style("top", (d3.event.layerY + 15) + "px")
                        .style("left", (d3.event.layerX - tooltip_width - 30) + "px");
                    }
                })
                .on("mouseout", function() {
                    $(this).attr("fill-opacity", "1.0");
                    $("#tooltip-container").hide();
                })
                .style("fill", function(d) {
                    if (valueById.get(d.properties.postalCode)) {
                        var i = scalemethod(valueById.get(d.properties.postalCode));
                        if(i) {
                            var color = mapcolors[i].getColors();
                        }
                        else{
                            var color = mapcolors[0].getColors();
                        }
                    } else {
                        var color = mapcolors[0].getColors();
                    }
                    return "rgb(" + color.r + "," + color.g +
                            "," + color.b + ")";

                });
        });
    }

    function updatemap(mapcolors, scalemethod)
    {
        var svg = d3.select("svg")

        svg.selectAll("path")
            .data(geojsonnyc.features)
            .transition()
            .duration(700)
            .style("fill", function(d) {
                if (valueById.get(d.properties.postalCode)) {
                    var i = scalemethod(valueById.get(d.properties.postalCode));
                    if(i) {
                        var color = mapcolors[i].getColors();
                    }
                    else{
                        var color = mapcolors[0].getColors();
                    }
                } else {
                    var color = mapcolors[0].getColors();
                }
                return "rgb(" + color.r + "," + color.g +
                        "," + color.b + ")";
            });

    }

</script>
</html>